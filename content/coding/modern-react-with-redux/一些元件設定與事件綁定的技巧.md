---
title: 'ä¸€äº› React å…ƒä»¶è¨­å®šèˆ‡äº‹ä»¶ç¶å®šçš„æŠ€å·§'
type: coding
log: 'log'
category: Modern React with Redux
tags: [React, Udemy]
description: 'åˆå§‹åŒ– stateã€è¨­ default propsã€è™•ç† this ç­‰ç­‰å•é¡Œ'
date: '2021-06-19'

---

ç¬¬å…­ç« è«‡åˆ° class component æœ‰ç”Ÿå‘½é€±æœŸï¼Œå³ç¹¼æ‰¿`React.Component` å¯å€Ÿç”¨çš„æ–¹æ³•ï¼Œé™¤äº† `render` ä¹‹å¤–ï¼Œå…¶ä»–å¯ä»¥è‡ªè¡Œæ±ºå®šæ˜¯å¦è¦å¯¦ä½œï¼Œå°‡æœƒåœ¨æŸäº›ç‰¹å®šæ™‚æ©Ÿé»è¢« React è§¸ç™¼ã€‚

å› ç‚ºä¹‹å‰å·²ç¶“å¯«é [Reactï¼šèªè­˜ç”Ÿå‘½é€±æœŸæ–¹æ³•åŠè§¸ç™¼æ™‚é–“é»](../../Lidemy/React Lifecycleï¼šèªè­˜ç”Ÿå‘½é€±æœŸæ–¹æ³•åŠè§¸ç™¼æ™‚é–“é»)ï¼Œé€™é‚Šæœƒå°±åŒæ¨£çš„éƒ¨åˆ†ç•¥éï¼Œä»¥ç´€éŒ„ CH6ã€CH7 ä¸­å­¸åˆ°çš„å¯¦ä½œçŸ¥è­˜ç‚ºä¸»ã€‚

---
<br>

##### ä¸åœ¨ constructor è¼‰å…¥è³‡æ–™

åœ¨ä¸€é–‹å§‹ç·´ç¿’æ™‚ï¼Œå°‡ç²å–ç”¨æˆ¶åœ°ç†ä½ç½®çš„ç¨‹å¼ç¢¼å¯«åœ¨äº† contructor è£¡ï¼Œä½†æ›´å¥½çš„æ–¹å¼ï¼Œæ˜¯è®“é€™äº›ç²å¾—è³‡æ–™çš„æ“ä½œæ”¾åœ¨ `componentDidMount` çµ±ä¸€ç®¡ç†ï¼Œconstructor åªç”¨ä¾†è¨­ç½®åˆå§‹åŒ– stateã€‚

- `componentDidMount` ç¬¬ä¸€æ¬¡æ¸²æŸ“åˆ°ç•«é¢ï¼Œè¨­å®šåˆå§‹ data

![](https://i.imgur.com/SRmgPlO.png)

---
<br>

##### åˆå§‹åŒ–ç‹€æ…‹çš„å¦ä¸€å¯«æ³•

state æ˜¯ä¸€å€‹ Javascript ç‰©ä»¶ï¼Œç‚º class component ç®¡ç†ç‹€æ…‹çš„åœ°æ–¹ï¼Œå‰é¢èªªéå› ç‚ºæ˜¯ç¹¼æ‰¿ï¼Œè¦å…ˆå¯¦ä½œ constructor ä¸¦å‘¼å« `super()` å¼•ç”¨çˆ¶é¡åˆ¥è¨­ç½®ï¼Œä¸ç„¶ç„¡æ³•ä½¿ç”¨ `this` è®Šæ•¸åŠåˆå§‹åŒ– `this.state`ï¼Œä¸éï¼Œå…¶å¯¦æœ‰å¦ä¸€ç¨®ç°¡å–®çš„æ–¹å¼å¯ä»¥è¨­å®š stateã€‚

**å°±æ˜¯ç›´æ¥å¯«**

ä¸éœ€è¦å¯« constructorï¼Œå»ç›¸ç•¶æ–¼åœ¨ constructor åˆå§‹åŒ– this.state

```javascript
class App extends React.Component {
  state = { lat: null, errorMessage: ''}

  render() {
    return (
      <div>Latitude:</div>
    )
  }
}
```

ç”¨ create react app å»ºç«‹ï¼Œå·²ç¶“å¼•ç”¨äº† `@babel/plugin-proposal-class-properties` å¥—ä»¶ï¼Œå¯ä»¥ä½¿ç”¨é€™å€‹å¯«æ³•ï¼Œå› ç‚º babel è‡ªå‹•å¹«æˆ‘å€‘å¯¦ä½œ constructorï¼Œä¸å¿…å†è‡ªå·±å®šç¾©æ§‹é€ å‡½æ•¸ã€å‘¼å« super åŠè™•ç† props


---
<br>

##### è¨­å®š default props
æ‡‰è©²æ»¿å¸¸åœ¨ç¨‹å¼ç¢¼ä¸­çœ‹åˆ°é€™ç¨®å¯«æ³•
```javascript
<div className="loader">{props.message || 'Loading...'}</div>
```

èª²ç¨‹ä»‹ç´¹é™¤äº†ç”¨ `||` è¨­ç½®é è¨­å€¼ï¼ŒReact å…¶å¯¦æœ‰ç‚º component æä¾›ã€Œ**defaultProps**ã€å±¬æ€§ï¼Œèƒ½ä½¿ç”¨å®ƒä¾†ç‚º props æ·»åŠ é è¨­å€¼ã€‚

ç•¶çˆ¶å…ƒä»¶å¦‚æœæ²’æœ‰å‚³å°æ‡‰çš„ props é€²ä¾†ï¼Œè‡ªå‹•å¸¶å…¥è¨­å®šé è¨­çš„å±¬æ€§å€¼ï¼Œä¸ç®¡æ˜¯ functional æˆ– class component éƒ½å¯ä»¥åŠ ä¸Šã€‚
```javascript
const Spinner = props => {
  return (
    <div>
      <div className="loader">{props.message}</div>
    </div>
  )
}

Spinner.defaultProps = {
  message: 'Loading...'
}
```

---
<br>

##### è‡ªè¡Œè¨­å®š renderbody

ä¸æ˜¯ä»€éº¼æŠ€å·§ï¼Œåªæ˜¯å¢é€²ç¨‹å¼ç¢¼çš„å¯è®€æ€§ã€‚

å‡è¨­ä»Šå¤©è¦æ¸²æŸ“çš„æ±è¥¿è¨­æœ‰å¤šé‡æ¢ä»¶ã€æˆ–åˆ¤æ–·å¤šï¼Œé€™ç¨®æƒ…æ³ä¸‹ä¸è¦æŠŠé‚è¼¯éƒ¨ä»½æ‘»åœ¨ return è£¡é¢ï¼Œå¯«æˆä¸€å€‹ functionï¼Œæ¸²æŸ“æ™‚å†å‘¼å«ã€‚

èˆ‰ä¾‹ï¼Œæˆ‘æœ‰ä¸€æ®µ JSXï¼Œæ˜¯æ ¹æ“š page ä¾†æ±ºå®šé¡¯ç¤ºï¼Œä»¥å¾€ç¿’æ…£ç”¨ä¸‰å…ƒé‹ç®—å­æˆ– `&&` é€²è¡Œåˆ¤æ–·ï¼š
```javascript
// æŒ‰ç…§ currentTab.page çš„å€¼æ¸²æŸ“å°æ‡‰é é¢
return (
  <div>
    <Tabs tabs={tabs} index={currentTab.index} />
    <>
      {currentTab.page === SERVICE_PAGE.CONTENT && <ServiceContent />}
      {currentTab.page === SERVICE_PAGE.RULES && <Rules />}
      {currentTab.page === SERVICE_PAGE.MY_PACKAGE && <MyPackage />}
    </>
  </div>
)
```

ä¸éï¼Œå…¶å¯¦èƒ½æ‹‰å‡ºä¾†å¯«æˆ functionï¼Œè®“ currentTab.page ä»¥åƒæ•¸å‚³å…¥ï¼Œè®“æ•´é«”é‚è¼¯æ‹‰å‡ºä¾†ï¼Œä¸æœƒéƒ½æ”¾åœ¨ return åˆ¤æ–·
```javascript
renderContent = (page) => {
  switch (page) {
    case SERVICE_PAGE.CONTENT:
      return <ServiceContent />
    case SERVICE_PAGE.RULES:
      return <Rules />
    case SERVICE_PAGE.MY_PACKAGE:
      return <MyPackage />
    default: 
      return <></>
  }
}

// å¥½åƒæ¸…çˆ½è¨±å¤šï¼Ÿ
render() {
  return (
    <div>
      <Tabs tabs={tabs} index={currentTab.index} />
      {renderContent(currentTab.page)}
    </div>
  )
}
```

---
<br>

##### ç•«é¢æ‡‰è©²ç”± React ä¾†æ§åˆ¶

åœ¨ React è£¡ï¼Œå…ƒä»¶æœ‰ controlled å’Œ uncontrolled å€åˆ¥ï¼Œå‰è€…é€é state ä¾†ä¿å­˜è³‡æ–™ã€åˆ©ç”¨ setState è¨­å®šå€¼ï¼Œå¾Œè€…å‰‡æ˜¯æ²’æœ‰ç¶å®š stateï¼Œåƒå‚³çµ±ä½œæ³•ç”± DOM æœ¬èº«è™•ç†ã€‚

ä»¥ç¨‹å¼ç¢¼ç‚ºä¾‹ï¼Œinput å…ƒç´ å°±æ˜¯ uncontrolled çš„å…ƒä»¶
```javascript
class SearchBar extends React.Component {
  render() {
    return (
      <form>
        <label>Search</label>
        <input type="text" />
      </form>
    )
  }
}
```
å®ƒçš„å€¼æ˜¯ç”± HTML å…ƒç´ å…§éƒ¨ç®¡ç†å’Œå­˜æ”¾ï¼Œç•¶ä»Šå¤©æˆ‘å€‘æƒ³åœ¨ React ä¸ŠçŸ¥é“ç¾åœ¨çš„ search value æ˜¯å¤šå°‘ï¼Œä¸å¾—ä¸é€éå…¶ä»–æ–¹å¼åˆ° DOM ä¸Šé¢æ‰¾å€¼ï¼Œå› ç‚ºä¸¦ä¸å­˜æ”¾åœ¨ React ä¸­ã€‚

![](https://i.imgur.com/vrzcY79.png)

uncontrolled çœ‹è‘—ç°¡å–®ï¼Œç„¶è€Œç•¶ä½ éœ€è¦æ§åˆ¶çš„ DOM æ•¸é‡ä¸€å¤šèµ·ä¾†ï¼Œæ‰‹å‹•æ“ä½œçš„é‡å°±è®Šå¾—ç¹é‡ï¼Œ è€Œ controlled component æ˜¯ç”±è³‡æ–™æœ¬èº«ä¾†æ›´å‹•ç•«é¢ï¼Œéµå¾ª Reactã€Œå–®å‘è³‡æ–™æµã€çš„åŸå‰‡ï¼Œæ‰€ä»¥æ‰éœ€è¦ä½¿ç”¨åˆ° stateï¼Œå› ç‚ºé€™é—œä¿‚äº†**è³‡æ–™æ˜¯å¦ç”± React æ‰€æ§åˆ¶**ã€‚

---

è€Œè¦æ€éº¼è®“ input çš„å€¼è¢« React æ‰€ç®¡ç†ï¼Œå°±è¦é€²è¡Œäº‹ä»¶ç¶å®šä¾†ç›£è½ã€‚

ä¸åŒäº‹ä»¶ï¼Œæœƒé€£çµä¸åŒçš„å±¬æ€§åç¨±ï¼Œåƒæ˜¯ onChangeã€onClickã€onSubmit ç­‰ç­‰ï¼Œå…¶å¯¦è·Ÿæˆ‘å€‘åŸæœ¬åœ¨å¯« HTML å…ƒç´ å¾ˆåƒï¼Œå°±æ˜¯è¦å…ƒç´ æœ¬èº«æ“æœ‰é€™å€‹äº‹ä»¶æ‰èƒ½è¨­å®šï¼Œåƒ div å°±ä¸æœƒæœ‰ submit äº‹ä»¶ã€‚

ç›£è½ input çš„ onChange äº‹ä»¶ï¼Œå¾åƒæ•¸ event å¯ä»¥æ‹¿åˆ°ç”¨æˆ¶å‰›å‰›éµå…¥çš„æ–‡å­—ï¼ŒæŠŠå®ƒå­˜å…¥ stateï¼Œä¸¦è¨­å®š input æ°¸é é¡¯ç¤º state å…§çš„è³‡æ–™ï¼Œé€™æ¨£ä¸€ä¾†å°±å¯ä»¥åšåˆ°è³‡æ–™è¢« React æ‰€ç®¡ç†ã€‚

```javascript
class SearchBar extends React.Component {
  state = { term: '' }
  
  render() {
    return (
      <form>
        <label>Search</label>
        <input
          type="text"
          value={this.state.term} // é¡¯ç¤º state çš„å€¼
          onChange={(e) => this.setState({ term: e.target.value })} // è®Šå‹•å°±æ”¹ state
        />
      </form>
    )
  }
}
```

---
<br>

##### è™•ç† class component ä¸­çš„ `this` å•é¡Œ

äº‹ä»¶ç¶å®šæ™‚ï¼Œå¦‚æœæ“ä½œå¾ˆå¤šæœƒå°‡ callback function æ‹‰å‡ºä¾†å¯«ï¼Œé€šå¸¸åˆ†é…çµ¦äº‹ä»¶çš„å›èª¿å‡½å¼æœƒä»¥å‘½å on æˆ– handle é–‹é ­ï¼Œä¾‹å¦‚ `onInputChange` æˆ– `handleInputChange`ï¼Œå…¶å¯¦å°±è·ŸåŸç”Ÿ JS å¯«æ³•äº‹ä»¶ç¶å®šå¯«æ³•ä¸€æ¨£ã€‚

ä½†æ˜¯ï¼Œå»é‡åˆ°ä»¥ä¸‹çš„å•é¡Œï¼Ÿ
```html
Cannot read property 'state' of undefined
```

å ±éŒ¯äº†ï¼å•é¡Œå°±å‡ºåœ¨ this ä¸Šï¼Ÿ

```javascript
class SearchBar extends React.Component {
  state = { term: '' }
  
  onFormSubmit(e) {
    e.preventDefault()
    console.log(this.state.term) // ğŸ”´ Cannot read property 'state' of undefined
  }
  
  render() {
    return (
      <form onSubmit={this.onFormSubmit}>
        <label>Search</label>
        <input
          type="text"
          value={this.state.term}
          onChange={(e) => this.setState({ term: e.target.value })}
        />
      </form>
    )
  }
}
```

åœ¨ onFormSubmit å‡½å¼è£¡é¢ç”¨åˆ°äº† `this`ï¼ŒåŸæœ¬æ˜¯æƒ³è¦å¼•ç”¨ searchBar é¡åˆ¥ï¼Œä½†é€™æ™‚çš„ `this.state` å°å‡ºä¾†å»æ˜¯ undefinedï¼Ÿ

---

åœ¨[å…‹æœ JavaScript çš„å¥‡æ€ªéƒ¨åˆ†](../../[ç­†è¨˜] å…‹æœ JS çš„å¥‡æ€ªéƒ¨åˆ†/)ä¸­æœ‰æåˆ°ï¼Œ`this` çš„å€¼å–æ±ºæ–¼å‡½å¼ä½ç½®åŠå‡½å¼è¢«å‘¼å«çš„æ–¹å¼ï¼Œä¸€èˆ¬æƒ…æ³éƒ½æ˜¯æŒ‡å‘ windowï¼Œç•¶å‡½å¼æ˜¯é€£çµåˆ°ç‰©ä»¶çš„æ–¹æ³•æ™‚ï¼ˆå³**ä½œç‚ºç‰©ä»¶çš„æ–¹æ³•è¢«å‘¼å«**ï¼‰ï¼Œthis æ‰æœƒæŒ‡å‘ç‰©ä»¶æœ¬èº«ã€‚

æœ‰ä¸‰ç¨®æ–¹å¼å¯ä»¥è§£æ±ºï¼š

1. åœ¨ constructor è¨­å®šï¼Œä»¥ bind æ–¹æ³•ç¶å¥½ this çš„å€¼

```javascript
class SearchBar extends React.Component {
  constructor(props) {
    super(props)
    this.state = { term: '' }
    this.onFormSubmit = this.onFormSubmit.bind(this) // âœ… it works!
  }
  
  onFormSubmit(e) {
    e.preventDefault()
    console.log(this.state.term)
  }
  
  // ...
}
```
2. å¯«æˆç®­é ­å‡½å¼ï¼ˆES6 ä¹‹å¾Œçš„åŠŸèƒ½ï¼‰

ä½¿ç”¨ç®­é ­å‡½å¼æœƒè‡ªå‹•å°‡ this çš„å€¼ç¢ºèªæŒ‡å‘

```javascript
class SearchBar extends React.Component {
  state = { term: '' }
  
  onFormSubmit = (e) => {  // âœ… this æŒ‡å‘ SearchBar
    e.preventDefault()
    console.log(this.state.term)
  }
  
  // ...
}
```

3. åœ¨ callback function è£¡é¢ä½¿ç”¨ç®­é ­å‡½å¼

```javascript
class SearchBar extends React.Component {
  state = { term: '' }
  
  onFormSubmit(e) {
    e.preventDefault()
    console.log(this.state.term)
  }
  render() {
    return ( // âœ… ç¢ºä¿ onFormSubmit çš„ this æŒ‡å‘ï¼Œä½œçˆ² this(SearchBar) è¢«å‘¼å«
      <form onSubmit={(e) => this.onFormSubmit(e)}>
        <label>Search</label>
        <input
          type="text"
          value={this.state.term}
          onChange={(e) => this.setState({ term: e.target.value })}
        />
      </form>
    )
}
```

ä¸éç¬¬ä¸‰ç¨®å•é¡Œæ¯”è¼ƒå¤§ï¼Œæ¯æ¬¡æ¸²æŸ“ searchBar æ™‚éƒ½æœƒå‰µå»ºä¸åŒçš„ callback functionï¼Œå¦‚æœé€™å€‹ callback function æœƒä½œç‚º props å‚³å…¥æ›´ä¸‹å±¤çš„å…ƒä»¶ï¼Œå°±æœƒé€ æˆä¸å¿…è¦çš„é‡è¤‡æ¸²æŸ“ï¼Œå»ºè­°ç”¨ç¬¬äºŒç¨®æ–¹å¼ä¾†ç¶å®šï¼Œé¿å…æ•ˆèƒ½å•é¡Œã€‚


---

> åƒè€ƒè³‡æ–™

- [[Day 09] React State & props]([https://](https://ithelp.ithome.com.tw/articles/10235204))
- [React äº‹ä»¶è™•ç†ä¸­çš„thisçš„æŒ‡å‘å•é¡Œ]([https://](https://zhuanlan.zhihu.com/p/278449050))
- [React å®˜æ–¹æ–‡ä»¶ - äº‹ä»¶è™•ç†](https://zh-hans.reactjs.org/docs/handling-events.html)
